<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>利用HiveQL实现对电商日志的分析，求出topN商品的信息。</p>
<h1 id="意义"><a href="#意义" class="headerlink" title="意义"></a>意义</h1><p>学会使用HiveQL对电商日志进行清洗和分析，用熟悉的SQL语句替代编写MapReduce程序。</p>
<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>本文所使用的环境如下：</p>
<ul>
<li>CentOS7</li>
<li>Jdk-1.8.+</li>
<li>Hadoop-2.7.3</li>
<li>Hive-2.3.3</li>
</ul>
<h1 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h1><p>完成该案例演示所需资源如下：</p>
<ul>
<li>测试数据源</li>
</ul>
<p>文件名称：access.log<br>文件具体内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">niit110,192.168.215.131 - - [28&#x2F;May&#x2F;2019:18:11:44 +0800] &quot;GET &#x2F;shop&#x2F;detail.html?id&#x3D;402857036a2831e001kshdksdsdk89912 HTTP&#x2F;1.0&quot; 200 4391 &quot;-&quot; &quot;ApacheBench&#x2F;2.3&quot; &quot;-&quot;</span><br><span class="line">niit110,192.168.215.131 - - [28&#x2F;May&#x2F;2019:18:11:44 +0800] &quot;GET &#x2F;shop&#x2F;detail.html?id&#x3D;402857036a2831e001kshdksdsdk89923 HTTP&#x2F;1.0&quot; 200 4391 &quot;-&quot; &quot;ApacheBench&#x2F;2.3&quot; &quot;-&quot;</span><br><span class="line">niit110,192.168.215.131 - - [28&#x2F;May&#x2F;2019:18:11:44 +0800] &quot;GET &#x2F;shop&#x2F;detail.html?id&#x3D;402857036a2831e001kshdksdsdk89933 HTTP&#x2F;1.0&quot; 200 4391 &quot;-&quot; &quot;ApacheBench&#x2F;2.3&quot; &quot;-&quot;</span><br><span class="line">niit110,192.168.215.131 - - [28&#x2F;May&#x2F;2019:18:11:44 +0800] &quot;GET &#x2F;shop&#x2F;detail.html?id&#x3D;402857036a2831e001kshdksdsdk89933 HTTP&#x2F;1.0&quot; 200 4391 &quot;-&quot; &quot;ApacheBench&#x2F;2.3&quot; &quot;-&quot;</span><br><span class="line">niit110,192.168.215.131 - - [28&#x2F;May&#x2F;2019:18:11:44 +0800] &quot;GET &#x2F;shop&#x2F;detail.html?id&#x3D;402857036a2831e001kshdksdsdk89944 HTTP&#x2F;1.0&quot; 200 4391 &quot;-&quot; &quot;ApacheBench&#x2F;2.3&quot; &quot;-&quot;</span><br><span class="line">niit110,192.168.215.131 - - [28&#x2F;May&#x2F;2019:18:11:44 +0800] &quot;GET &#x2F;shop&#x2F;detail.html?id&#x3D;402857036a2831e001kshdksdsdk89944 HTTP&#x2F;1.0&quot; 200 4391 &quot;-&quot; &quot;ApacheBench&#x2F;2.3&quot; &quot;-&quot;</span><br><span class="line">niit110,192.168.215.131 - - [28&#x2F;May&#x2F;2019:18:11:44 +0800] &quot;GET &#x2F;shop&#x2F;detail.html?id&#x3D;402857036a2831e001kshdksdsdk89912 HTTP&#x2F;1.0&quot; 200 4391 &quot;-&quot; &quot;ApacheBench&#x2F;2.3&quot; &quot;-&quot;</span><br><span class="line">niit110,192.168.215.131 - - [28&#x2F;May&#x2F;2019:18:11:44 +0800] &quot;GET &#x2F;shop&#x2F;detail.html?id&#x3D;402857036a2831e001kshdksdsdk89923 HTTP&#x2F;1.0&quot; 200 4391 &quot;-&quot; &quot;ApacheBench&#x2F;2.3&quot; &quot;-&quot;</span><br><span class="line">niit110,192.168.215.131 - - [28&#x2F;May&#x2F;2019:18:11:44 +0800] &quot;GET &#x2F;shop&#x2F;detail.html?id&#x3D;402857036a2831e001kshdksdsdk89933 HTTP&#x2F;1.0&quot; 200 4391 &quot;-&quot; &quot;ApacheBench&#x2F;2.3&quot; &quot;-&quot;</span><br><span class="line">niit110,192.168.215.131 - - [28&#x2F;May&#x2F;2019:18:11:44 +0800] &quot;GET &#x2F;shop&#x2F;detail.html?id&#x3D;402857036a2831e001kshdksdsdk89933 HTTP&#x2F;1.0&quot; 200 4391 &quot;-&quot; &quot;ApacheBench&#x2F;2.3&quot; &quot;-&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>连接工具</li>
</ul>
<p>putty</p>
<h1 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h1><ul>
<li>分析日志</li>
</ul>
<p>思路：上述资源中所列出的日志信息，其中/shop/detail.html?id=402857036a2831e001kshdksdsdk89923代表的是id为    402857036a2831e001kshdksdsdk89923的商品的URI，我们只需要找出所有的的商品URI，对其进行分组统计，就可以得出每种商品被访问过的次数，进而可以对其访问量进行排名，实现topN的功能。</p>
<p>方法：经过观察，我们发现每行访问记录中大部分都是以空格形式进行间隔的，而且目标URI两端都是被空格分开的，由此我们可以按照空格对每行文本进行分割，进而选择空格作为下一步创建外部表的列的分隔符。</p>
<ul>
<li>上传日志文件到服务器</li>
</ul>
<p>将access.log上传到服务器上的HDFS下的/datas/logs目录下</p>
<ul>
<li>建立hive外部表</li>
</ul>
<p>&lt;% codeblock %&gt;<br>create external table logs_ex(client_ip string,crossbar1 string,crossbar2 string,time string,time_sufix string,req string,uri string,protocol string,status int,count int,crossbar3 string,user_agent string,crossbar4 string) row format delimited fields terminated by ‘ ‘ lines terminated by ‘\n’ location ‘/datas/logs’;<br>&lt;% endcodeblock %&gt;</p>
<ul>
<li>编写分析的SQL语句</li>
</ul>
<p>&lt;% codeblock %&gt;<br>select uri,count(1) total from logs_ex group by uri order by total desc limit 3;<br>&lt;% endcodeblock %&gt;</p>
<ul>
<li><p>执行分析的SQL语句</p>
</li>
<li><p>查看结果<br><img src="/images/result.png" alt="结果"></p>
</li>
</ul>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>本文使用HiveQL简单实现了对电商日志的分析，其关键点在于了解如何分析日志的思路和方法，找到我们所需要的目标字段，然后根据日志的格式创建Hive外部表，最后通过编写SQL语句来实现。本文仅作为学习HiveQL来实现某一个应该场景而已。实际生产工作中，还要具体问题具体分析。祝各位读者道友们一切顺利~</p>
